#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GitHub –±–µ–∑ –ø–∞—Ä–æ–ª—è

echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –¥–ª—è GitHub..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SSH –∫–ª—é—á–∞
if [ ! -f ~/.ssh/id_ed25519.pub ]; then
    echo "üìù –°–æ–∑–¥–∞—é –Ω–æ–≤—ã–π SSH –∫–ª—é—á..."
    ssh-keygen -t ed25519 -C "petr-tartyshev@users.noreply.github.com" -f ~/.ssh/id_ed25519 -N ""
else
    echo "‚úÖ SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
echo ""
echo "üìã –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏ –¥–æ–±–∞–≤—å –µ–≥–æ –≤ GitHub:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
cat ~/.ssh/id_ed25519.pub
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º SSH config –¥–ª—è GitHub
echo "‚öôÔ∏è  –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é SSH config..."
mkdir -p ~/.ssh
cat >> ~/.ssh/config << 'EOF'

# GitHub
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_ed25519
    IdentitiesOnly yes
    AddKeysToAgent yes
    UseKeychain yes
EOF

# –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –≤ ssh-agent
echo "üîê –î–æ–±–∞–≤–ª—è—é –∫–ª—é—á –≤ ssh-agent..."
eval "$(ssh-agent -s)"
ssh-add --apple-use-keychain ~/.ssh/id_ed25519 2>/dev/null || ssh-add ~/.ssh/id_ed25519

echo ""
echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –°–∫–æ–ø–∏—Ä—É–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤—ã—à–µ"
echo "2. –û—Ç–∫—Ä–æ–π https://github.com/settings/keys"
echo "3. –ù–∞–∂–º–∏ 'New SSH key'"
echo "4. –í—Å—Ç–∞–≤—å –∫–ª—é—á –∏ —Å–æ—Ö—Ä–∞–Ω–∏"
echo "5. –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏: ssh -T git@github.com"
echo ""
