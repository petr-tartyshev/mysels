#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

SERVER="root@45.130.8.3"
PROJECT_DIR="/root/sels"

echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
echo ""

ssh $SERVER << 'ENDSSH'
cd /root/sels

echo "üìã 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
git log --oneline -1
echo ""

echo "üìã 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ git:"
git status --short
echo ""

echo "üìã 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
docker ps --filter "name=sels" --format "table {{.Names}}\t{{.Status}}\t{{.Image}}"
echo ""

echo "üìã 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ app/profile/page.tsx:"
if [ -f "app/profile/page.tsx" ]; then
    echo "–§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    grep -c "–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é" app/profile/page.tsx || echo "–ö–Ω–æ–ø–∫–∞ '–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ!"
    echo ""
    echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å '–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é':"
    grep -n "–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é" app/profile/page.tsx | tail -3
else
    echo "‚ùå –§–∞–π–ª app/profile/page.tsx –Ω–µ –Ω–∞–π–¥–µ–Ω!"
fi
echo ""

echo "üìã 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ Docker –æ–±—Ä–∞–∑–∞:"
docker images sels-web --format "{{.CreatedAt}}" | head -1
echo ""

echo "üìã 6. –õ–æ–≥–∏ –≤–µ–±-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫):"
docker logs sels_web --tail 20 2>&1 | tail -20
echo ""

echo "üìã 7. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω:"
docker exec sels_web sh -c "grep -c '–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é' /app/app/profile/page.tsx 2>/dev/null || echo '–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ'"
echo ""

ENDSSH

echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
